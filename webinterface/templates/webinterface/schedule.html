{% extends "webinterface/mobile_first_body.html" %}
{% load crispy_forms_tags %}

{% block title %}
{{ schedule.name }}
{% endblock %}

{% block main %}
    <div class="row">
        <div class="btn btn-group btn-group-md btn-group-justified" role="group">
            {% include "webinterface_snippets/home_button.html" %}
            {% if not user.is_superuser %}
                {% include "webinterface_snippets/button_to_schedule_list_page.html" %}
            {% endif %}
        </div>
    </div>

    <div class="row">
        <div class="panel panel-primary" style="margin-bottom: 0">
            <div class="panel-heading">
                <h3>{{ schedule.name }} - Putzdienste</h3>
            </div>
        </div>
    </div>

    {% if user.is_superuser %}
        <div class="row" style="padding: 5px">
            <div class="col-xs-12">
                <a class="btn btn-info btn-sm btn-block"
                   href="{% url 'webinterface:assignment-create-back-to-schedule' schedule.pk page_obj.number %}"
                   role="button">
                    Erzeuge Putzdienste oder aktualisiere Aufgaben
                </a>
            </div>
        </div>
    {% endif %}

    {% include "webinterface_snippets/schedule_pagination_buttons.html" %}

    <table class="table table-striped" style="margin-bottom: 0">
        <tr>
            <!--td> </td-->
            <td><span class="glyphicon glyphicon-calendar"></span> Datum</td>
            <td><span class="glyphicon glyphicon-user"></span> Putzer</td>
            {% if user.is_superuser %}
                <td> </td>
            {% endif %}
        </tr>

        {% for cleaning_week in cleaningweek_list %}
                <tr class="
{% if cleaning_week.disabled or not cleaning_week.assignments_valid %}danger
{% elif cleaning_week.tasks_are_ready_to_be_done %}success{% endif %}">

                    <td>{{ cleaning_week.assignment_date|date:"d. M, Y" }}</td>
                    <td>
                        {% if not cleaning_week.disabled %}
                            {% if not cleaning_week.assignments_valid %}
                                <b>Wegen einer Änderung von Zugehörigkeiten in diesem Zeitraum müssen die
                                Putzdienste in dieser Woche aktualisiert werden</b>
                            {% else %}
                                <a class="btn btn-default"
                                   href="{% url 'webinterface:assignment-tasks-back-to-schedule' cleaning_week.pk page_obj.number %}"
                                   role="button">
                                    {% for assignment in cleaning_week.assignment_set.all %}
                                        {{ assignment.cleaner.name }}{% if not forloop.last %} & {% endif %}
                                    {% empty %}
                                        Keine Putzer
                                    {% endfor %}
                                    {% if not cleaning_week.is_in_future %}
                                        <span class="label label-default">
                                            {{ cleaning_week.completed_tasks.count }} / {{ cleaning_week.task_set.count }}
                                        </span>
                                    {% endif %}
                                </a>
                            {% endif %}
                        {% else %}
                            <b>In dieser Woche deaktiviert</b>
                        {% endif %}
                    </td>

                    {% if user.is_superuser %}
                        <td>
                            <div class="btn-group">
                                <button type="button"
                                        class="btn
                                               {% if cleaning_week.tasks_valid and cleaning_week.assignments_valid %}btn-default
                                               {% else %}btn-warning
                                               {% endif %}
                                              dropdown-toggle"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <span class="glyphicon glyphicon-cog"></span> <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu">
                                    {% for assignment in cleaning_week.assignment_set.all %}
                                        <li><a href="{% url 'webinterface:assignment-edit' assignment.pk page_obj.number %}">
                                            <span class="glyphicon glyphicon-cog"></span>
                                            {{ assignment.cleaner }}'s Dienst bearbeiten
                                        </a></li>
                                    {% endfor %}
                                    <li role="separator" class="divider"></li>
                                    <li><a href="{% url 'webinterface:cleaning-week-edit' cleaning_week.pk page_obj.number %}">
                                        <span class="glyphicon glyphicon-off"></span> Aktivieren/Deaktivieren
                                    </a></li>
                                    {% if not cleaning_week.tasks_valid %}
                                        <li class="bg-danger">
                                            <a href="{% url 'webinterface:cleaning-week-tasks' cleaning_week.pk page_obj.number %}">
                                                <span class="glyphicon glyphicon-plus"></span> Aufgaben aktualisieren
                                            </a>
                                        </li>
                                    {% endif %}
                                    {% if not cleaning_week.assignments_valid %}
                                        <li class="bg-danger">
                                            <a href="
{% url 'webinterface:assignment-create-init' schedule.pk page_obj.number cleaning_week.week cleaning_week.week%}">
                                                <span class="glyphicon glyphicon-refresh"></span> Putzdienste aktualisieren
                                            </a>
                                        </li>
                                    {% endif %}
                                    <li role="separator" class="divider"></li>
                                    <li><a href="{% url 'webinterface:cleaning-week-delete' cleaning_week.pk page_obj.number %}">
                                        <span class="glyphicon glyphicon-warning-sign"></span> Löschen
                                    </a></li>
                                </ul>
                            </div>
                        </td>
                    {% endif %}
                </tr>
        {% empty %}
            Keine Putzdienste vorhanden...
        {% endfor %}
    </table>
    {% include "webinterface_snippets/schedule_pagination_buttons.html" %}
    <br>
    {% if page_obj.0.week %}
        <div class="row" style="padding: 5px">
            <div class="col-xs-12">
                <a href="{% url 'webinterface:schedule-analystics-view-with-schedule-page' schedule.slug page_obj.number %}"
                   class="btn btn-default btn-block" role="button">
                    <span class="glyphicon glyphicon-dashboard"></span> Analytics zu {{ schedule }}
                </a>
            </div>
        </div>

        <div class="row" style="padding: 5px">
            <div class="col-xs-12">
                <a href="{% url 'webinterface:schedule-print-view' schedule.slug page_obj.0.week %}"
                   class="btn btn-default btn-block" role="button">
                    <span class="glyphicon glyphicon-print"></span> Druckansicht (ab erstem Datum dieser Seite)
                </a>
            </div>
        </div>
    {% endif %}
    <br><br>
{% endblock %}