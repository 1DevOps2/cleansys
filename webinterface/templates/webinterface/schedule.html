{% extends "webinterface/mobile_first_body.html" %}
{% load crispy_forms_tags %}

{% block title %}
{{ schedule.name }}
{% endblock %}

{% block main %}
    <div class="row" style="margin: 1em">
        <div class="col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3">
            <a class="btn btn-block btn-default" role="button"
                href="{% url 'webinterface:schedule-list' %}">
                <span class="glyphicon glyphicon-chevron-left"></span> Zurück
            </a>
        </div>
    </div>

    <div class="panel panel-info">
        <div class="panel-heading">
            <h3 class="panel-title">Putzdienst vom {{ schedule.get_active_assignments.first.date }}</h3>
        </div>
        <div class="panel-body">
            <h5>Wer was gemacht hat</h5>
            {% for assignment in schedule.get_active_assignments %}
                <h4><span class="glyphicon glyphicon-user"></span> {{ assignment.cleaner.name }}:
                    {% for task in assignment.tasks_cleaned %}
                        <span class="label label-default">{{ task.name }}</span>
                    {% endfor %}
                </h4>
            {% endfor %}
            <p><i>Kontaktiere den XXX im Beschwerdefall direkt.</i></p>
        </div>
    </div>

    <div class="row">
        <div class="panel panel-primary" style="margin-bottom: 0">
            <div class="panel-heading">
                <h3>{{ schedule.name }} - Putzdienste</h3>
            </div>
        </div>
    </div>
    {% include "webinterface_snippets/schedule_pagination_buttons.html" %}
        <table class="table table-striped" style="margin-bottom: 0">
            <tr>
                <td><span class="glyphicon glyphicon-calendar"></span></td>
                <td><span class="glyphicon glyphicon-user"></span></td>
            </tr>
            {% comment %}We only need regrouping because we can't use
               distinct('date') in sqlite databases. {% endcomment %}
            {% regroup page by date as grouped_by_date %}
            {% for assignment in grouped_by_date %}
                <tr>
                    <td>{{ assignment.list.0.date }}</td>
                    <td {% if highlighted_cleaner in assignment.list.0.cleaners_on_date_for_schedule.all %}
                        class="success" {% endif %}>
                        {% for cleaner in assignment.list.0.cleaners_on_date_for_schedule.all %}
                            {{ cleaner.name }}
                            {% ifnotequal cleaner assignment.list.0.cleaners_on_date_for_schedule.last %},
                            {% endifnotequal %}
                        {% empty %}
                            Keine Putzer
                        {% endfor %}
                    </td>
                </tr>
            {% endfor %}
        </table>
    {% include "webinterface_snippets/schedule_pagination_buttons.html" %}
    {% comment %}<div class="row" style="padding: 1em">
        <h4>Hebe Putzer hervor</h4>
        <div class="col-xs-12 col-sm-4 col-md-3" style="padding: 5px">
            <a class="btn btn-default btn-sm btn-block {% if not highlighted_cleaner %} active {% endif %}"
                style="white-space: normal"
                role="button" href="{% url 'webinterface:schedule-view' schedule.slug page.number %}">
                <span class="glyphicon glyphicon-home"></span> Zurücksetzen
            </a>
        </div>

        {% for cleaner in cleaners %}
            <div class="col-xs-6 col-sm-4 col-md-3" style="padding: 5px">
                <a class="btn btn-default btn-sm btn-block
                    {% ifequal highlighted_cleaner.name cleaner.name %} active {% endifequal %}"
                    role="button"
                    href="{% url 'webinterface:schedule-view-highlight' schedule.slug page.number cleaner.slug %}">
                    <span class="glyphicon glyphicon-user"></span> {{ cleaner.name }}
                </a>
            </div>
        {% endfor %}
    </div>{% endcomment %}
{% endblock %}